# TeleScribe Assist - 未実装機能・仕様差異リスト

このドキュメントは、src/ ディレクトリに実装されているコードと docs/仕様書.md の仕様を比較し、未実装または仕様と異なる実装を整理したものです。

## 📝 更新履歴

### 2025年最新更新
- ✅ **時刻変数の詳細設定機能 完全実装完了**
  - TimeInputコンポーネント新規作成（時刻入力・調整・リロード機能）
  - TimeVariableSettingsModalコンポーネント新規作成（詳細設定UI）
  - フォーマットプリセット6種類 + カスタム入力対応
  - 丸め設定UI完全実装（有効/無効・単位・方法選択）
  - 責任分離によるコンポーネント設計改善
  - React最適化パターン適用（memo, useCallback）

- ✅ **文節編集の候補表示・オートコンプリート機能 完全実装完了**
  - AutocompleteInputコンポーネント新規作成（候補表示・選択機能）
  - テンプレート・入力履歴・変数候補の統合表示
  - {{ 入力時の変数候補自動切り替え機能
  - キーボードナビゲーション（↑↓、Enter、Escape）
  - 前方一致フィルタリングとリアルタイム候補更新
  - SegmentItemコンポーネントとの統合

- ✅ **変数使用状況管理機能 完全実装完了**
  - helpers.jsに変数使用状況分析ロジック追加（analyzeVariableUsage, analyzeVariableDeletionImpact）
  - 未使用変数の自動検出とリアルタイム更新機能
  - 未使用変数の視覚的ハイライト表示（黄色テキスト + 未使用ラベル）
  - 使用中変数削除時の詳細警告システム（使用箇所明示）
  - データ整合性の強化とユーザビリティの向上

- ✅ **プレビュー編集時の変数保持機能 完全実装完了**
  - 変数値同期システム（updateVariablesFromPreview関数）実装
  - プレビュー編集時の変数値自動更新機能
  - セグメント内の{{変数名}}参照の完全保持
  - 単一変数・複数変数両対応の値抽出アルゴリズム
  - 新しい行の追加・削除機能との統合

- ✅ **レスポンシブ対応 完全実装完了**
  - 狭幅時 1カラムレイアウトへ自動切替（`App.jsx` コンテナに `flex-col lg:flex-row` 適用）
  - 左右パネルを `w-full lg:w-1/2` で幅制御し、縦積み時も高さ・スクロール安定（`min-h-0` 維持）
  - サイドバーをモバイルでドロワー化（`SessionSidebar.jsx` を `fixed` オーバーレイ + `translate-x` トランジションに変更）
  - バックドロップタップで閉じる挙動を追加（`App.jsx`）
  - アクセシビリティ属性追加（`aria-controls`/`aria-expanded`/`role`/`aria-label`）

## 1. 時刻変数の詳細設定機能（✅ 完了）

### 1.1 フォーマット設定機能
**仕様書要件（2.1）:** 時刻変数に以下の設定機能が必要
- プリセット選択（`YYYY/MM/DD HH:mm` や `HH:mm` など）
- カスタム入力（フォーマット指定文字の直接入力）
- ライブプレビュー表示

**現在の実装状況:**
- ✅ 基本的な時刻入力は実装済み（TimeInput.jsx:17-179）
- ✅ プリセット選択機能実装済み（TimeVariableSettingsModal.jsx:87-96）
- ✅ カスタムフォーマット編集UI実装済み（TimeVariableSettingsModal.jsx:100-121）
- ✅ ライブプレビュー実装済み（TimeInput.jsx、TimeVariableSettingsModal.jsx）
- ✅ 6種類のフォーマットプリセット定義済み（constants.js:116-124）

### 1.2 丸め設定UI
**仕様書要件（2.1）:** 丸め機能の詳細設定UI
- チェックボックスでの有効/無効切り替え
- 丸める単位のドロップダウン（1分/5分/10分/15分/30分）
- 丸め方のドロップダウン（切り捨て/四捨五入/切り上げ）

**現在の実装状況:**
- ✅ 丸め設定のUI実装済み（TimeVariableSettingsModal.jsx:125-169）
- ✅ 有効/無効切り替えチェックボックス実装済み（TimeVariableSettingsModal.jsx:129-137）
- ✅ 丸める単位ドロップダウン実装済み（TimeVariableSettingsModal.jsx:142-153）
- ✅ 丸め方法ドロップダウン実装済み（TimeVariableSettingsModal.jsx:155-167）
- ✅ 丸め処理ロジックは実装済み（DateUtils.js:26-49）
- ✅ 丸め設定オプション定義済み（constants.js:130-143）

### 1.3 時刻入力UX機能（追加実装）
**新規実装機能:**
- ✅ 時刻調整ボタン（±）で分単位増減（TimeInput.jsx:37-74）
- ✅ 現在時刻リロードボタン（🔄）（TimeInput.jsx:24-29）
- ✅ 詳細設定モーダル（⚙️）アクセス（TimeInput.jsx:151-154）
- ✅ コンポーネント責任分離（VariableInput.jsx → TimeInput.jsx委譲）

## 2. 文節編集の候補表示機能（✅ 完了）

### 2.1 候補表示ロジック
**仕様書要件（2.5）:** 以下の候補表示ロジックが必要
- フィールドが空でフォーカス時：テンプレート・入力履歴を一覧表示
- 文字入力中：前方一致する候補のみ表示
- `{{` 入力時：変数一覧を候補表示

**現在の実装状況:**
- ✅ 候補表示機能完全実装済み（AutocompleteInput.jsx:1-297）
- ✅ フィールド空時のテンプレート・履歴表示実装済み（AutocompleteInput.jsx:50-79）
- ✅ 文字入力中の前方一致フィルタリング実装済み（AutocompleteInput.jsx:80-90）
- ✅ {{ 入力時の変数候補表示実装済み（AutocompleteInput.jsx:42-65）
- ✅ テンプレートデータ活用済み（constants.js:74-98）
- ✅ 入力履歴データ活用済み（constants.js:107-110）

### 2.2 オートコンプリート機能
**仕様書要件（2.5）:** インタラクティブな候補選択機能

**現在の実装状況:**
- ✅ キーボードナビゲーション実装済み（AutocompleteInput.jsx:160-190）
- ✅ マウスクリック選択実装済み（AutocompleteInput.jsx:270-285）
- ✅ 候補カテゴリ別表示実装済み（AutocompleteInput.jsx:275-285）
- ✅ SegmentItemコンポーネント統合済み（SegmentItem.jsx:70-78）
- ✅ リアルタイム候補更新実装済み（AutocompleteInput.jsx:100-109）

## 3. 変数と本文の連携機能（✅ 完了）

### 3.1 未使用変数のハイライト
**仕様書要件（2.4）:** 使用されていない変数の視覚的ハイライト

**現在の実装状況:**
- ✅ 未使用変数の検出・ハイライト機能実装済み（helpers.js:28-74, App.jsx:91-94, 320-327）
- ✅ 黄色のテキストと「(未使用)」ラベルによる視覚的区別
- ✅ ツールチップによる使用状況表示（「未使用の変数です」/「使用中の変数です」）

### 3.2 使用中変数の削除警告
**仕様書要件（2.4）:** 使用中変数削除時の警告モーダルと使用箇所明示

**現在の実装状況:**
- ✅ 削除警告機能実装済み（helpers.js:88-117, App.jsx:329-342）
- ✅ 使用箇所の詳細表示（影響するセグメント一覧）
- ✅ 使用数の明示（「○箇所で使用されています」）
- ✅ 確認ダイアログによる誤削除防止

## 4. プレビュー編集時の変数保持機能（✅ 完了）

### 4.1 変数値同期システム
**解決された課題:**
- プレビュー領域でのテキスト編集時に変数が実値で上書きされる問題
- 変数の動的性が失われる（{{変数名}} → 固定値）
- 変数参照の完全な消失

**実装されたソリューション:**
- ✅ **変数値同期システム**の完全実装（helpers.js:236-386）
- ✅ プレビュー編集時の変数値自動更新
- ✅ セグメント内の{{変数名}}参照の完全保持
- ✅ App.jsx のプレビューonChangeハンドラーに統合（App.jsx:283-319）

### 4.2 技術実装詳細
**Core Functions (helpers.js):**
- ✅ `updateVariablesFromPreview()`: メイン同期処理
- ✅ `extractSingleVariableValue()`: 単一変数値抽出（正規表現パターンマッチング）  
- ✅ `extractMultipleVariableValues()`: 複数変数値抽出（差分解析）

**対応範囲:**
- ✅ 単一変数を含む行での確実な値更新
- ✅ 複数変数を含む行での基本的な値更新
- ✅ 新しい行の追加・削除への対応
- ✅ Undo/Redo機能との完全連携

### 4.3 動作確認済み
- ✅ プレビューでの変数値変更 → 基本情報の変数値自動更新
- ✅ セグメント内の{{変数名}}参照が保持される
- ✅ 変数使用状況表示の正常更新
- ✅ 状態管理システムとの完全統合

## 5. テンプレート管理機能（✅ 完了）

### 5.1 テンプレート機能
**仕様書要件（2.6）:** 文節テンプレートとブロックテンプレートの管理

**現在の実装状況:**
- ✅ テンプレートデータ構造定義済み（constants.js:74-98）
- ✅ テンプレート選択・管理UI実装済み（TemplateManagerModal.jsx）
- ✅ 文節テンプレートの追加・編集・削除実装済み（TemplateManagerModal.jsx）
- ✅ ブロックテンプレートの追加・編集・削除実装済み（TemplateManagerModal.jsx）
- ✅ ブロックテンプレート適用（末尾追加/全置換）実装済み（App.jsx）
- ✅ 文節編集の候補表示にテンプレートが反映（AutocompleteInput.jsx ← App.jsxで渡す `templates.segment`）
- ✅ 現在の内容をブロックとして保存する機能を実装（SaveBlockTemplateModal.jsx + App.jsxヘッダー）
- ✅ ブロックまるごとの呼び出し（ヘッダーから選択して追加/置換）を実装（App.jsxヘッダーUI）

## 5. UI/UX関連の未実装・差異

### 5.1 レスポンシブ対応（✅ 完了）
**仕様書要件（3.1）:** 画面幅が狭い場合の1カラムレイアウト

**現在の実装状況:**
- ✅ 狭幅時 1カラム切替を実装済み（`App.jsx`）
- ✅ サイドバーのモバイルドロワー化を実装済み（`SessionSidebar.jsx` + `App.jsx` バックドロップ）
- ✅ 高さとスクロールの安定化（`min-h-0`維持、各ラッパーに適用）

### 5.2 テーマ切り替え機能（✅ 完了）
**仕様書要件（3.1）:** ライトモード・ダークモード切り替え

**現在の実装状況:**
- ✅ テーマ切り替え機能を実装
  - `App.jsx` にテーマ状態（`light`/`dark`）とトグルボタンを追加（永続化: `localStorage`）
  - `index.css` に `.theme-light` による一括上書きスタイルを追加（Tailwindカラーの代表値を `!important` で反転）
  - `index.html` に起動前適用スクリプトを追加し、FOUCを防止
  - アクセシビリティ属性（`aria-label`/`aria-pressed`）付与
- ✅ ダークモード基調のデザインは従来通り維持

**実装詳細:**
- `App.jsx`:
  - LocalStorageキー: `telescribeAssistTheme`
  - ルート要素（`<html>`）へ `theme-light` クラスを付与/削除
  - ヘッダー右側にサン/ムーンアイコンのトグルを追加
- `index.css`:
  - `.theme-light` 下で `bg-gray-900/800/700`, `text-gray-100/300/400`, `text-white` などをライト配色に上書き
  - `gradient-title`/`gradient-accent` をライト向け配色に調整
  - 入力キャレット・プレースホルダー色をライト向けに変更
- `index.html`:
  - 起動前に `localStorage` を確認し、`theme-light` を `<html>` に付与

## 6. エラーハンドリング機能（部分実装）

### 6.1 エラー通知システム
**仕様書要件（4.2）:** 3段階のエラー通知システム
- レベル1：モーダルダイアログ
- レベル2：スナックバー・トースト
- レベル3：コンソールログ

**現在の実装状況:**
- ✅ 基本的なエラーハンドリングは実装済み（dataService.js:64-66）
- ❌ 体系的なエラー通知システム未実装
- ❌ スナックバー・トースト機能未実装

## 7. 将来的な拡張機能（優先度：低）

### 7.1 リッチテキスト編集機能
**仕様書要件（5.1）:** 文節内の装飾機能（太字、斜体、取り消し線など）

**現在の実装状況:**
- ❌ リッチテキスト編集機能未実装（優先度低）

## まとめ

### ✅ 完了済み項目
1. **時刻変数の詳細設定UI** - ✅ 完全実装完了（2025年最新変更）
2. **文節編集の候補表示・オートコンプリート機能** - ✅ 完全実装完了（2025年最新変更）
3. **変数使用状況の管理機能** - ✅ 完全実装完了（2025年最新変更）
4. **プレビュー編集時の変数保持機能** - ✅ 完全実装完了（2025年最新変更）

### 高優先度の未実装項目
（なし）

### 中優先度の未実装項目
1. 体系的なエラーハンドリング

### 低優先度の未実装項目
1. リッチテキスト編集機能

## 実装推奨順序

1. ~~**時刻変数の詳細設定UI**~~ - ✅ **完了**（TimeInput + TimeVariableSettingsModal実装済み）
2. ~~**候補表示・オートコンプリート機能**~~ - ✅ **完了**（AutocompleteInput + SegmentItem統合実装済み）
3. ~~**変数使用状況管理**~~ - ✅ **完了**（helpers.js + App.jsx統合実装済み）
4. ~~**プレビュー編集時の変数保持機能**~~ - ✅ **完了**（変数値同期システム実装済み）
5. **テンプレート管理UI** - 作業効率の向上
6. ~~**レスポンシブ対応**~~ - ✅ **完了**（モバイル対応実装済み）
7. **テーマ切り替え機能** - UX向上
8. **エラーハンドリング強化** - 安定性向上

### 次の開発推奨項目
**最優先**: テーマ切り替え機能 / 体系的なエラーハンドリング