<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleScribe Assist - 電話応対報告文作成補助サイト</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- External Dependencies -->
    <script>
        // 起動前にライトテーマ適用（FOUC回避）
        try {
            if (localStorage.getItem('telescribeAssistTheme') === 'light') {
                document.documentElement.classList.add('theme-light');
            }
        } catch (e) {}
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- Phone number formatting library (for accurate JP formatting) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/libphonenumber-js/1.12.10/libphonenumber-js.min.js"></script>

    <!-- App Version -->
    <script>
        window.__APP_VERSION__ = undefined;
    </script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="src/styles/index.css">
</head>
<body class="bg-gray-900 text-gray-100">
    <div id="root"></div>

    <!-- Utility Scripts -->
    <script src="src/utils/generalUtils.js"></script>
    <script src="src/utils/phoneUtils.js"></script>
    <script src="src/utils/templateEngine.js"></script>
    <script src="src/utils/previewSyncCore.js"></script>
    <script src="src/utils/variablesAnalysis.js"></script>
    <script src="src/utils/dateUtils.js"></script>
    <script src="src/utils/diffUtils.js"></script>
    <script src="src/utils/templateUtils.js"></script>

    <!-- Data and Constants -->
    <script src="src/data/constants.js"></script>

    <!-- Services -->
    <script src="src/services/dataService.js"></script>

    <!-- Hooks -->
    <script src="src/hooks/useLocalStorage.js"></script>
    <script src="src/hooks/useUndoRedo.js"></script>
    <script src="src/hooks/useDragDrop.js"></script>
    <script src="src/hooks/usePreviewSync.js"></script>
    <script src="src/hooks/useTheme.js"></script>
    <script src="src/hooks/useGroupSuggestions.js"></script>
    <script src="src/hooks/useDiffStatus.js"></script>
    <script src="src/hooks/useAutoSelectBlock.js"></script>
    <script src="src/hooks/useToast.js"></script>
    <script src="src/hooks/useTemplateOps.js"></script>

    <!-- Components -->
    <script type="text/babel" src="src/components/UIDialogs.jsx"></script>
    <script type="text/babel" src="src/components/PhoneInput.jsx"></script>
    <script type="text/babel" src="src/components/DataManagementModal.jsx"></script>
    <script type="text/babel" src="src/components/SaveBlockTemplateModal.jsx"></script>
    <script type="text/babel" src="src/components/TemplateManagerModal.jsx"></script>
    <script type="text/babel" src="src/components/TimeVariableSettingsModal.jsx"></script>
    <script type="text/babel" src="src/components/TimeInput.jsx"></script>
    <script type="text/babel" src="src/components/VariableInput.jsx"></script>
    <script type="text/babel" src="src/components/PreviewPane.jsx"></script>
    <script type="text/babel" src="src/components/VariablesPanel.jsx"></script>
    <script type="text/babel" src="src/components/SegmentsPane.jsx"></script>
    <script type="text/babel" src="src/components/SessionSidebar.jsx"></script>
    <script type="text/babel" src="src/components/AutocompleteInput.jsx"></script>
    <script type="text/babel" src="src/components/SegmentItem.jsx"></script>
    <script type="text/babel" src="src/components/VariableModal.jsx"></script>
    <script type="text/babel" src="src/components/VariableEditModal.jsx"></script>
    <script type="text/babel" src="src/components/App.jsx"></script>

    <!-- App Initialization (version.txt を読み込んでから描画) -->
    <script type="text/babel">
        (async () => {
            try {
                const res = await fetch('version.txt', { cache: 'no-store' });
                const text = await res.text();
                window.__APP_VERSION__ = (text || '').trim() || 'dev';
            } catch (e) {
                window.__APP_VERSION__ = 'dev';
            }
            ReactDOM.render(React.createElement(Components.App), document.getElementById('root'));
        })();
    </script>

    <!-- Service Worker Registration (cache busting by version) -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                try { navigator.serviceWorker.register('sw.js'); } catch (e) {}
                try {
                    let __ts_controller_reloaded__ = false;
                    navigator.serviceWorker.addEventListener('controllerchange', function() {
                        // 新しいSWがコントロールを取得したらリロードして最新資産を反映（多重リロード防止）
                        if (__ts_controller_reloaded__) return;
                        __ts_controller_reloaded__ = true;
                        window.location.reload();
                    });
                } catch (e) {}
            });
        }
    </script>

    <!-- Offline fallback (静的に提供) -->
    <link rel="prefetch" href="offline.html" as="document">
</body>
</html>